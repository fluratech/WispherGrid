<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WispherGrid - A peer-to-peer chat app that is serverless, decentralized, and ephemeral">
    <meta name="theme-color" content="#1a1a2e">
    <title>WispherGrid - Peer-to-Peer Chat</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- Home Screen -->
        <div id="home-screen" class="screen active">
            <div class="container">
                <header>
                    <h1>WispherGrid</h1>
                    <p class="subtitle">Peer-to-Peer Communication</p>
                </header>
                
                <div class="form-group">
                    <label for="username-input">Your Name</label>
                    <input 
                        type="text" 
                        id="username-input" 
                        placeholder="Enter your name" 
                        maxlength="30"
                        autocomplete="off"
                    >
                </div>
                
                <div class="form-group">
                    <label for="room-input">Room Name</label>
                    <input 
                        type="text" 
                        id="room-input" 
                        placeholder="Enter or generate room name" 
                        maxlength="50"
                        autocomplete="off"
                    >
                    <button id="generate-room-btn" class="btn-secondary" title="Generate random room name">
                        <i class="fas fa-dice"></i>
                    </button>
                </div>
                
                <div class="button-group">
                    <button id="join-room-btn" class="btn-primary">Join Room</button>
                </div>
                
                <div class="info-box">
                    <h3>How it works</h3>
                    <ul>
                        <li>üîí All communication is encrypted end-to-end</li>
                        <li>üåê No central servers - direct peer-to-peer connection</li>
                        <li>üí® Messages disappear when you leave</li>
                        <li>üìπ Support for video and audio calls</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Chat Room Screen -->
        <div id="chat-screen" class="screen">
            <div class="chat-container">
                <header class="chat-header">
                    <button id="back-btn" class="btn-icon" title="Leave room">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="room-info">
                        <h2 id="room-name-display">Room</h2>
                        <p id="peer-count">Connecting...</p>
                    </div>
                    <div class="header-actions">
                        <button id="video-call-btn" class="btn-icon" title="Start Video Call">
                            <i class="fas fa-video"></i>
                        </button>
                        <button id="connection-status-btn" class="btn-icon" title="Connection Status">
                            <i class="fas fa-link"></i>
                        </button>
                        <button id="settings-btn" class="btn-icon" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </header>
                
                <div id="media-container" class="compact-videos hidden">
                    <div id="remote-videos" class="remote-videos-grid"></div>
                    <div id="local-video-wrapper" class="local-video-compact">
                        <video id="local-video" autoplay muted playsinline></video>
                        <div class="video-controls">
                            <button id="toggle-video" class="btn-video" title="Toggle Video">
                                <i class="fas fa-video"></i>
                            </button>
                            <button id="toggle-audio" class="btn-video" title="Toggle Audio">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button id="end-call-btn" class="btn-video btn-end-call" title="End Call">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="messages-container">
                    <div id="messages-list"></div>
                </div>
                
                <div class="message-input-container">
                    <button id="attach-btn" class="btn-attach" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input 
                        type="text" 
                        id="message-input" 
                        placeholder="Type a message..." 
                        maxlength="5000"
                        autocomplete="off"
                    >
                    <input type="file" id="file-input" style="display: none;" multiple>
                    <button id="send-btn" class="btn-send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- Connection Status / Manual Signaling -->
                <div id="connection-status" class="connection-status hidden">
                    <div class="connection-content">
                        <h3>Connect Another Device</h3>
                        <p>Share this room code or scan QR code:</p>
                        <div class="room-code-display" id="room-code-display"></div>
                        <div id="qr-code-container"></div>
                        <div class="signaling-section">
                            <h4>Manual Connection (if automatic fails):</h4>
                            <button id="copy-offer-btn" class="btn-copy">Copy Connection Info</button>
                            <textarea id="paste-signal-input" placeholder="Paste connection info from other device..." rows="3"></textarea>
                            <button id="paste-signal-btn" class="btn-paste">Connect</button>
                        </div>
                        <button id="close-connection-status" class="btn-close-status">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="btn-close" id="close-settings-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="enable-video" checked>
                            Enable Video
                        </label>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="enable-audio" checked>
                            Enable Audio
                        </label>
                    </div>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="play-sounds">
                            Play notification sounds
                        </label>
                    </div>
                    <div class="setting-group">
                        <!-- Don't need this
                         <label for="theme-select">Theme</label>
                        <select id="theme-select">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                            <option value="auto">Auto</option>
                        </select> -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Connection Status Toast -->
        <div id="toast" class="toast"></div>
    </div>
    
    <script type="module" src="js/app.js"></script>
</body>
</html>
